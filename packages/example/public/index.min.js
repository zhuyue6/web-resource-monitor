!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).webResourceMonitor={})}(this,(function(e){"use strict";const t={audio:["wav","mp3","wma","midi","acc","cda","ape","ra"],video:["mp4","mpeg","avi","3gp","rm","wmv","flv","bd","mkv"],img:["jpg","jpeg","png","gif","bmp","tiff","webp"],css:["css","ttf"],script:["js","vue","ts"]},r={script:100,css:100,xmlhttprequest:200,fetch:200,audio:5e3,video:1e4,img:500};function o(){const e=new Map;return{on(t,r){r!==e.get(t)&&e.set(t,r)},emit(t,...r){const o=e.get(t);o?.(...r)},off(t){e.delete(t)},destroy(){e.clear()}}}function n(e,t,r,o,n="normal"){const i={name:o.name,fileType:t,resourceType:r,initiatorType:o?.initiatorType,duration:o.duration};e.loadedList.push({...i,entry:o}),e.emit("loaded",i,o),"timeout"===n&&(e.loadedTimeoutList.push({...i,entry:o}),e.emit("loadedTimeout",i,o))}function i(e){const i=o(),s={resourceTimeoutConfig:e?.resourceTimeoutConfig??r,fileMatcher:e?.fileMatcher??t,loadedList:[],loadedTimeoutList:[],on:i.on,off:i.off,emit:i.emit,start:()=>{},destroy:()=>{}},c={resource(e){const[t,r]=function(e,t){const r=[],o=/([^\s.])*$/.exec(String(e.name).replace(/\?\S*/,"")),n=o&&o[0];for(const[e,o]of Object.entries(t.fileMatcher))o.includes(n)&&r.push(e);return[n,r]}(e,s);for(const[o,i]of Object.entries(s.resourceTimeoutConfig).reverse())if(r?.includes(o)){const r=e.duration>=i?"timeout":void 0;n(s,t,o,e,r)}}};let u=function(e){return new PerformanceObserver((t=>{for(const r of t.getEntries()){const t=e[r.entryType];t&&t(r)}}))}(c);return s.start=()=>{u?.observe({entryTypes:Object.keys(c)})},s.destroy=()=>{u?.disconnect(),u=null},s}function s(){const e=o(),t={collectionList:[],on:e.on,off:e.off,emit:e.emit,start:()=>{},destroy:()=>{}};function r(e){!function(e,t){const r={url:t.filename,lineno:t.lineno,colno:t.colno,message:t.message??t.error.message,stack:t.error.stack,browser:window.navigator.userAgent};e.collectionList.push({...r,error:t}),e.emit("error",r,t)}(t,e)}return t.start=()=>{window.addEventListener("error",r)},t.destroy=()=>{window.removeEventListener("error",r)},t}const c=i;e.createErrorListener=s,e.createMonitor=function(e){let t={resourceListener:i(e?.resourceListenerConfig),errorListener:s(),start:()=>{t?.resourceListener.start(),t?.errorListener.start()},destroy:()=>{t?.resourceListener.destroy(),t?.errorListener.destroy(),t=null}};return t},e.createReport=c,e.createResourceListener=i,e.getResourceConfigDefault=function(){return{fileMatcherDefault:t,resourceTimeoutConfigDefault:r}}}));
